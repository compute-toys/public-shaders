fn w(T:f32)->vec3f{let Q=vec3f(0.5,0.5,0.5);let P=vec3f(0.5,0.5,0.5);let J=vec3f(1.0,1.0,1.0);let H=vec3f(0.263,0.416,0.557);return Q+P*cos(6.28318*(J*T+H));}fn v(z:vec3f)->vec3f{var x=z+vec3f(12.34,56.78,90.12);var a=fract(x*vec3f(0.1031,0.1030,0.0973));a=a+dot(a,a.yzx+19.19);return fract(vec3f(a.x+a.y,a.y+a.z,a.z+a.x)*a.zxy);}fn m(s:f32)->mat2x2<f32>{let n:f32=sin(s);let r:f32=cos(s);return mat2x2(r,-n,n,r);}fn t(U:vec3<f32>,S:f32)->f32{return length(U)-S;}fn u(R:vec3<f32>)->f32{var d=R;let G=custom.twist*0.1;d=vec3f(d.xy*m(d.z*0.05*sin(G*0.5)),d.z);let l=8.0;let k=vec3<i32>(floor(d/l));let i=v(vec3f(f32(k.x),f32(k.y),f32(k.z))+1337.0);let K=1.0;if (i.x>=K){return 0.9;}var h=(d/l);h=fract(h)-0.5;let A=(pow(sin(4.0*time.elapsed),4.0)+1.0)/2.0;let B=custom.viz*0.4;let C=(i.yzx-vec3f(0.5))*mix(0.1,0.3+B,A);let D=(vec3f(h)+C);let E=mix(0.05,0.12,i.z)+(custom.viz*0.15);let F=t(D,E);return F*l;}@compute @workgroup_size(16,16) fn main_image(@builtin(global_invocation_id) e:vec3u){let c=textureDimensions(screen);if (e.x>=c.x||e.y>=c.y){return;}let I=vec2f(f32(e.x)+.5,f32(c.y-e.y)-.5);var f=(I*2.0-vec2f(f32(c.x),f32(c.y)))/f32(c.y);let y=custom.twist;f=f*m(y*0.1);let L=8.0;let M=0.6-(custom.viz*0.2);let N=vec3f(0,0,-3+time.elapsed*L);let O=normalize(vec3f(f*M,1.0));var g=0.0;var b=vec3<f32>(0);for(var q:i32=0;q<80;q++){var p=N+O*g;var j=u(p);let o=w(p.z*0.04+time.elapsed*0.2);let V=0.008+(custom.viz*0.01);let W=8.0;b+=o*V*exp(-j*W);if (j<0.001){b+=o*2.0;break;}g+=j*0.7*(1.0-custom.viz);if (g>150.0){break;}}b=b/(b+1.0);b=pow(b,vec3f(1.0/2.2));let X=length(f);b*=1.0-X*0.5;textureStore(screen,e.xy,vec4f(b,1.));}